# 文件的索引节点 inode

## Q

- 如何查看文件的链接数和 inode？
- Linux 中如何（确保）删除某文件？
- （单层级的）新目录的链接数是多少？具体是什么？

## A

Linux 会为每一个文件分配一个对应的索引节点 inode，inode = index node，它本身不存储信息，只是存储关于文件的元数据（不包括文件名和文件内容）。

- `ls -i` 可以显示文件的 inode
- 在 Linux 中，唯一一个确保能够删除掉文件（`rm`）的办法是，它的链接数为 0。想要找到一个 inode 有哪些地方有引用，使用 `find` 命令
- 使用 `ls -l` 查看文件信息，紧跟在权限信息后面的第二列，就是这个文件的链接数

refer: [`ls` Command](https://www.notion.so/ls-Command-df1c5d6129aa4afaa7e06dd10c2133a5?pvs=21) 

**新目录的链接数是多少？**

在 Unix 和类 Unix 系统（如 Linux）中，当你新建一个目录时，它的链接数默认会是 2。

这个链接数的由来是：

1. 一个链接是目录本身的名字，它存在于其父目录中
2. 另一个链接是目录内的特殊目录 "." ，它指向目录本身

如果你在这个目录中再创建新的子目录，那么父目录的链接数将增加 1（因为每个子目录都有一个 ".." 链接指向其父目录）。

所以在创建新目录时，链接数默认是 2。

---

@July 18, 2023 碰到了一个好玩的问题记录一下——在宿主机上误删了容器挂载的目录，后续重新创建，但容器无法往这个目录写入文件了。若尝试在其中创建文件或者往里拷贝文件，会出现 cannot open regular file 的错误。

- 解决思路：查看目录的链接数，发现为 0，正常情况下应该至少为 2。
- 解决方案：force recreate 容器。

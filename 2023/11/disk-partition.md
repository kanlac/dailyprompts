# 块设备，文件系统，磁盘分区

## 使用什么命令可以查看块设备，文件系统或者磁盘分区？

```
# lsblk
NAME            MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
sda               8:0    0   200G  0 disk
├─sda1            8:1    0   500M  0 part /boot
└─sda2            8:2    0 199.5G  0 part
  └─centos-root 253:0    0 199.5G  0 lvm  /
sr0              11:0    1   973M  0 rom

# df -h | grep -v /var/lib/docker
文件系统                 容量  已用  可用 已用% 挂载点
devtmpfs                 3.9G     0  3.9G    0% /dev
tmpfs                    3.9G     0  3.9G    0% /dev/shm
tmpfs                    3.9G  259M  3.6G    7% /run
tmpfs                    3.9G     0  3.9G    0% /sys/fs/cgroup
/dev/mapper/centos-root  200G   61G  139G   31% /
/dev/sda1                497M  232M  266M   47% /boot
tmpfs                    783M     0  783M    0% /run/user/0

# fdisk -l
磁盘 /dev/sda：214.7 GB, 214748364800 字节，419430400 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0x0005deed

   设备 Boot      Start         End      Blocks   Id  System
/dev/sda1   *        2048     1026047      512000   83  Linux
/dev/sda2         1026048   419430399   209202176   8e  Linux LVM

磁盘 /dev/mapper/centos-root：214.2 GB, 214219882496 字节，418398208 个扇区
Units = 扇区 of 1 * 512 = 512 bytes
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
```

## 块设备

`lsblk` 命令查看实际占用磁盘空间的块设备，例如硬盘、分区和 LVM 卷等。`-f` 选项可以查看文件系统。

1. **sda** - 这是一个200GB的物理硬盘（标识为主设备号8，次设备号0）。
2. **sda1** - 这是`/dev/sda`硬盘上的第一个分区，大小为500MB（标识为主设备号8，次设备号1）。这个分区被挂载为`/boot`，这个目录通常包含操作系统启动时所需的文件，例如Linux内核和初始RAM磁盘（initrd）。
3. **sda2** - 这是`/dev/sda`硬盘上的第二个分区，大小为199.5GB（标识为主设备号8，次设备号2）。这个分区没有直接挂载，而是作为物理卷被用在逻辑卷管理（LVM）中。
    - **centos-root** - 这是一个逻辑卷（标识为主设备号253，次设备号0），它使用了`sda2`分区提供的整个199.5GB空间。这个逻辑卷被挂载为根文件系统`/`，这意味着它包含了大部分系统文件和用户数据。
4. **sr0** - 这代表了一个光驱设备，其容量为973MB（标识为主设备号11，次设备号0）。由于`MOUNTPOINT`列为空，我们可以知道当前没有挂载光盘映像或光盘。

## 文件系统

`df` 命令查看已挂载的文件系统。

`devtmpfs` 和 `tmpfs` 是两种虚拟内存文件系统，它们不对应于磁盘上的实际分区，因此它们不会显示在 `lsblk` 的输出中。

1. **devtmpfs**: 这是一个由内核自动创建的临时文件系统，主要用于在 `/dev` 目录下动态管理设备节点。每当系统中添加或删除设备时（比如通过udev），`devtmpfs` 都会自动更新，以反映当前系统的硬件状态。`devtmpfs` 通常在系统启动时由内核挂载到 `/dev`。
2. **tmpfs**: 这是一个基于内存的文件系统，可以用于创建临时文件存储，如系统重启后不需要保留的数据。`tmpfs` 的内容存储在虚拟内存中，并且可以根据需要动态增长或缩小。系统上的 `/dev/shm`, `/run`, 和 `/sys/fs/cgroup` 等目录通常使用 `tmpfs` 来挂载。例如，`/run` 存储运行时数据，如PID文件和锁文件，而 `/dev/shm` 用于共享内存操作。

这两种文件系统并不占用硬盘空间，而是直接在内存中分配空间，所以它们在 `lsblk` 输出中不可见。

## 分区表

`fdisk -l` 查看分区表。

「磁盘标签类型：dos」这里表示用的是（DOS 时代标准的）MBR 分区表，而不是更新的 GPT。MBR 有最多4个主分区的限制。

## 如何创建分区并挂载为 /data

创建新分区之前，需要确保有空余的没有被分区的空间，否则会报错。

要添加一个新分区并将其挂载到 `/data` 目录，进行以下步骤：

1. **分区磁盘**
    
    假设你想要在现有的磁盘上（例如 `/dev/sda`）创建一个新的分区，你可以使用 `fdisk` 或 `parted` 命令。请注意，这可能会导致数据丢失，所以在对现有磁盘进行分区之前请务必备份重要数据。
    
    例如，使用 `fdisk` 的命令如下：
    
    ```bash
    sudo fdisk /dev/sda
    ```
    
    在 `fdisk` 命令中，你可以使用 `n` 来创建新分区，`p` 选择分区类型为主分区或 `e` 为扩展分区，然后根据提示进行操作。一旦完成，使用 `w` 保存更改并退出。
    
    提示 The partition table has been altered! 表示创建成功，需要重启生效
    
2. **格式化分区**
    
    创建分区后，你需要对其进行格式化。假设新分区是 `/dev/sda3`，你可以使用 `mkfs` 命令来格式化为 `ext4` 文件系统：
    
    ```bash
    sudo mkfs.ext4 /dev/sda3
    
    ```
    
3. **创建挂载点**
    
    确保 `/data` 目录存在，如果不存在则创建它：
    
    ```bash
    sudo mkdir /data
    
    ```
    
4. **挂载分区**
    
    一旦分区格式化完成，你可以手动挂载它到 `/data`：
    
    ```bash
    sudo mount /dev/sda3 /data
    
    ```
    
5. **自动挂载分区**
    
    为了确保每次启动系统时都自动挂载这个新分区，你需要编辑 `/etc/fstab` 文件。首先，备份当前的 `fstab` 文件：
    
    ```bash
    sudo cp /etc/fstab /etc/fstab.backup
    
    ```
    
    然后打开 `/etc/fstab` 文件：
    
    ```bash
    sudo nano /etc/fstab
    
    ```
    
    在文件末尾添加以下行（确保替换成你的分区标识和适当的文件系统类型）：
    
    ```
    /dev/sda3    /data    ext4    defaults    0    2
    
    ```
    
    保存并关闭文件。然后，你可以通过以下命令挂载所有在 `fstab` 中的分区，这将包括你新建的 `/data`：
    
    ```bash
    sudo mount -a
    
    ```
    
6. **验证挂载**
    
    使用以下命令确认新分区已经成功挂载：
    
    ```bash
    df -h
    
    ```
    
    或者
    
    ```bash
    mount | grep /data
    
    ```
    

以上步骤假设 `/dev/sda` 上有足够的未分配空间。如果没有足够的空间，你需要添加一个新硬盘或者调整现有分区（这通常更加复杂且风险更高）。始终确保在进行分区和格式化之前备份数据。
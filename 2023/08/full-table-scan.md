# 全表扫描 Full Table Scan

全表扫描通常发生在以下几种情况：

1. 表没有索引，或者索引不适用于查询条件。
2. 查询条件很模糊，导致使用索引效率不高。
3. 数据表非常小，全表扫描比使用索引更快。
4. 数据库优化器决定全表扫描比使用索引更高效（例如，进行大量数据的批处理操作）。

### SQL 示例

1. 无索引表的全表扫描
    
    ```sql
    SELECT * FROM users WHERE age = 30;
    
    ```
    
    如果表 `users` 没有针对 `age` 列的索引，则会进行全表扫描。
    
2. 不适用的索引
    
    ```sql
    SELECT * FROM users WHERE age + 5 = 30;
    
    ```
    
    如果存在一个针对 `age` 的索引，由于查询条件进行了算数操作，索引可能无法使用。
    
3. 模糊查询
    
    ```sql
    SELECT * FROM users WHERE name LIKE '%Smith%';
    
    ```
    
    这样的查询条件会使得即使存在索引也不一定会使用。
    

### 锁的使用

全表扫描是否会用到锁取决于数据库管理系统（DBMS）和事务隔离级别。在某些设置下，全表扫描可能会锁住整个表，特别是在对表进行修改（如 `DELETE`, `UPDATE` 等）而不仅仅是读取（`SELECT`）的情况下。

1. 在 MySQL InnoDB 存储引擎中，如果使用的是可重复读（REPEATABLE READ）或更低的隔离级别，全表扫描通常不会锁住整个表。
2. 在 SQL Server 中，全表扫描可能会用到表级锁，但这也取决于事务隔离级别和查询优化器的决策。
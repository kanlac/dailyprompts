# 数据库高可用需要考虑什么问题

1. 如何读取
2. 如何写入
    1. 几个节点可写？主备是一种常用的方案，只有主节点可写，备用节点分为 hot standby（可读的实时备份）和 warm standby（延时备份，直到成为主节点之前不可读）
    2. 主从如何同步，同步复制、异步复制还是半同步复制？异步复制是指主库执行完提交的事务后立刻将结果返回给客户端，并不关心从库是否已经同步了数据；同步复制是指主库执行完提交的事务，所有的从库都执行了该事务才将结果返回给客户端；半同步复制指主库执行完后，至少一个从库接收并执行了事务才返回给客户端。有多种主要是因为异步复制客户端写入性能高，但是存在丢数据的风险，在数据一致性要求不高的场景下可以采用，同步方式写入性能差，适合在数据一致性要求高的场景使用
3. 节点故障怎么处理？如何做故障转移
    - 故障转移后，备变主，新主需要在旧主起来后通知其成为备，Postgres 本身不提供这样的机制
    - 旧主起来后，可以使用 pg_rewind 工具修复时间线分裂，同步新主上的变更数据
    - 故障转移后，可以是等待旧主恢复，也可以是在第三个节点上创建新备
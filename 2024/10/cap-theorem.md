# CAP 定理

介绍 CAP 定理及其三种分布式系统模型。

## CAP Theorem

分布式数据存储不可能同时满足以下三个条件：

1. 一致性 consistency，每个节点每次读取都能获得最新数据或者错误
2. 可用性 availability，每个节点都可用，都能成功处理请求
3. 分区容错性 partition tolerance，当节点故障或者网络中断，系统仍可继续运行

## 三种分布式系统

1. CA 系统，如两阶段提交（2PC, Two-Phase Commit）协议，第一阶段准备，协调者向所有参与者发送准备请求，并等待所有参与者准备好；第二阶段提交，如果所有参与者都同意，协调者向他们发送提交请求，如果有参与者拒绝，协调者通知所有参与者回滚
2. CP 系统，如 Paxos 算法或者 etcd 使用的 Raft 算法。注意它和我们平常说的高可用系统并不冲突，因为它只是牺牲部分节点的可用性，但是保持整个系统可用。分区故障恢复后，需要处理共识和领导者选举等问题
3. AP 系统，如 Gossip 或者 Amazon Dynamo，需要处理数据冲突和维护数据版本

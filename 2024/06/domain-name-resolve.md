# DNS 域名解析

## 域名解析命令

```bash
nslookup YOUR_DOMAIN
# ---- Output ----
# Server:		8.8.8.8
# Address:	8.8.8.8#53
# 
# Non-authoritative answer:
# Name:	YOUR_DOMAIN
# Address: 192.168.70.xxx
# ----
# 注意，这里虽然显示 DNS 服务器是 8.8.8.8，但不代表一定是它
# 解析出来的! 比如内网域名可能就是由网关解析

# 没有 nslookup 命令时可以用这个
getent hosts YOUR_DOMAIN
```

## 如何查看当前网络连接所使用的 DNS 服务器

`cat /etc/resolv.conf`

或者，如果系统使用 NetworkManager，可以执行：

```
# nmcli device show
GENERAL.DEVICE:                         ens192
...
IP4.DNS[1]:                             8.8.8.8
```

## 如何修改 Linux 上的 DNS

如果在文件 /etc/resolv.conf 中看到 # Generated by NetworkManager 字样，且 systemctl status NetworkManager 看到 active，则可以通过 NetworkManager 来修改 DNS。

修改 DNS 设置可以通过以下几种方式进行：

### 使用 `nmcli` 命令行工具

`nmcli` 是 NetworkManager 提供的命令行接口。

### 通过 `resolv.conf` 文件

修改 `/etc/resolv.conf` 文件，保存后立即生效，但不推荐，因为 NetworkManager 可能会在重新启动或连接更改时覆盖这些设置。

## 如何给 k8s 中的容器配置 DNS

1. 通过 Pod 的 `spec.dnsPolicy` 字段
    1. ClusterFirst（默认）：使用集群的 DNS 服务
    2. Default：使用节点的 DNS 设置
    3. None：允许自定义 DNS 设置
2. 通过 CoreDNS 的 ConfigMap，配置集群级别的 DNS
    
    ```bash
    kubectl edit configmap coredns -n kube-system
    ```

## **How To Configure DNS For Docker Containers**

https://forums.docker.com/t/how-to-config-the-dns-for-a-container/52395/2?u=ridethesnake

## 如何配置容器的域名解析

使用 `--add-host` 或者 Docker Compose 的 `extra_hosts`：

```yaml
user-api:
	extra_hosts:
    - "YOUR_DOMAIN:55.128.2.1"
```

## 使用代理工具时如何确保内网域名正确解析

配置 /etc/hosts；配置系统网络代理 bypass（浏览器访问）或修改 NO_PROXY 环境变量（终端访问）。

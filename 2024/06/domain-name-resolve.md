# DNS 域名解析

## 域名解析命令

```bash
nslookup YOUR_DOMAIN
# ---- Output ----
# Server:		8.8.8.8
# Address:	8.8.8.8#53
# 
# Non-authoritative answer:
# Name:	YOUR_DOMAIN
# Address: 192.168.70.xxx
# ----
# 注意，这里虽然显示 DNS 服务器是 8.8.8.8，但不代表一定是它
# 解析出来的! 比如内网域名可能就是由网关解析

# 没有 nslookup 命令时可以用这个
getent hosts YOUR_DOMAIN
```

refer [getent](https://www.notion.so/getent-5188ac80016f4313beb70dd625be0b3c?pvs=21) 

## 如何查看当前网络连接所使用的 DNS 服务器

`cat /etc/resolv.conf`

或者，如果系统使用 NetworkManager，可以执行：

```
# nmcli device show
GENERAL.DEVICE:                         ens192
...
IP4.DNS[1]:                             8.8.8.8
```

## 如何修改 DNS

如果在文件 /etc/resolv.conf 中看到 # Generated by NetworkManager 字样，且 systemctl status NetworkManager 看到 active，则可以通过 NetworkManager 来修改 DNS。

修改 DNS 设置可以通过以下几种方式进行：

### 1. 使用 `nmcli` 命令行工具

`nmcli` 是 NetworkManager 提供的命令行接口。你可以使用以下命令来修改特定连接的 DNS 设置：

1. **列出所有连接：**
    
    ```bash
    nmcli connection show
    ```
    
    找到你要修改的连接的名称（例如 `MyConnection`）。
    
2. **修改连接的 DNS 设置：**
    
    ```bash
    nmcli connection modify MyConnection ipv4.dns "8.8.8.8 8.8.4.4"
    ```
    
3. **保存并重新启动连接：**
    
    ```bash
    nmcli connection down MyConnection
    nmcli connection up MyConnection
    ```
    

### 2. 编辑连接配置文件

NetworkManager 的连接配置文件通常位于 `/etc/NetworkManager/system-connections/` 目录下。你可以直接编辑该目录下的相应文件来修改 DNS 设置。

1. **找到对应的连接文件：**
    
    ```bash
    ls /etc/NetworkManager/system-connections/
    ```
    
    找到你要修改的连接文件，例如 `MyConnection.nmconnection`。
    
2. **编辑该文件：**
    
    ```bash
    sudo nano /etc/NetworkManager/system-connections/MyConnection.nmconnection
    ```
    
    在 `[ipv4]` 部分添加或修改 `dns` 行：
    
    ```
    [ipv4]
    method=auto
    dns=8.8.8.8;8.8.4.4;
    dns-search=
    ```
    
3. **保存文件并重启 NetworkManager：**
    
    ```bash
    sudo systemctl restart NetworkManager
    ```
    

### 3. 使用图形化界面（GNOME Network Manager）

省略。

### 4. 通过 `resolv.conf` 文件

修改 `/etc/resolv.conf` 文件，保存后立即生效，但不推荐，因为 NetworkManager 可能会在重新启动或连接更改时覆盖这些设置。

## 如何配置容器的域名解析

使用 `--add-host` 或者 Docker Compose 的 `extra_hosts`：

```yaml
user-api:
	extra_hosts:
    - "YOUR_DOMAIN:55.128.2.1"
```

## 使用代理工具时如何确保内网域名正确解析

配置 /etc/hosts；配置系统网络代理 bypass（浏览器访问）或修改 NO_PROXY 环境变量（终端访问）。

# 容器核心技术

## 核心技术

Docker 使用 Linux 内核的一些特性实现它的基本功能：

1. Docker 会为新创建的容器创建一系列的命名空间 namespace，例如 pid 命名空间做进程隔离，net 命名空间做网络隔离。
2. 使用 cgroup（控制组）限制、监控和隔离进程组的 CPU、内存、IO 等资源。
3. 通过分层镜像实现了更快的部署和启动。

一个小细节：(1) 通过 FS 命名空间做文件系统的隔离 和 (3) 联合文件系统 都会用到 chroot 系统调用。

## 容器与虚拟机的比较

容器相对虚拟机的优势是没有额外的性能损耗，缺点则是（通过 unshare namespace 来实现的）隔离不够彻底，用的还是相同的内核。比如在容器里执行 `top`，看到的依然是宿主机的内存和 CPU 的信息，这是因为 /proc 文件系统并不了解 Cgroup 的存在。又比如容器通过 `settimeofday(2)` 系统调用修改时间，那么整个宿主机的时间都会随之被修改。虽然有 Seccomp 等技术限制容器可以发起的系统调用，但是也不能完美地兼顾性能和隔离性。

# 公私钥密码学

## Q

- 公私钥密码学技术包含哪几类？区别是什么？代表算法？
- SSH 使用的是哪种加密算法？

---

在非对称加密算法问世以前，人们采用对称加密以防止第三方获得 Alice 和 Bob 之间的通讯内容，然而这样做的前提是，它们需要先安全地交换一副私钥。密钥交换（**Key Exchange**）描述的就是通过一个双方可信赖的通道交换密钥，以在网络中建立起安全通信的过程。过去，这个可信赖的渠道常常是邮寄或快递的形式。

公私钥密码学：

1. 对称密钥算法（**Symmetric**-key Algorithms），又称私钥密码学（Private-key Cryptography），用同一把密钥进行加密和解密。例：2001 年的 **AES**（Advanced Encryption Standard）。
2. 非对称密钥算法（**Asymmetric**-key Algorithms），又称公钥密码学（Public-key Cryptography），使用公钥加密信息，只有私钥能够解密。例：1977 年的 **RSA** 或现在安全系数更高的 **Ed25519**。
3. 数字签名（Digital **Signature**），使用非对称加密原理，但将其用于签名功能。发送方使用私钥进行签名，接收方使用公钥可以验签。

可是，我们知道 SSH 在实际传输用户数据的时候使用的是 AES 对称加密算法，既然非对称加密已经能（通过交换各自的公钥）保证双方的安全通信，为什么还需要对称加密呢？不是多此一举吗？这是因为非对称加密算法的效率比对称加密算法低很多，工作中我们使用 SSH 传输的数据量可能很大，只使用非对称加密是不现实的。

为了使用更高效的对称加密，必须有可靠的方式交换密钥。因此，密钥交换（Key Exchange）的问题依然存在。

1976 年，两名密码学家发布了一种密码学协议——迪菲·赫尔曼密钥交换协议（Diffie–Hellman key exchange，简称 **DH**），这项协议使得用户可以在被监控的情况下也能够安全地交换密钥，也就是说，它允许 Alice 和 Bob 两方在没有任何预先准备的前提下，在不安全的网络中建立起可安全通信的通道。

然而，DH 密钥交换协议本身并不解决身份验证问题（即确定通信通道另一端的实际身份的问题）。 当对手可以监视和更改通信通道内的消息（也称为中间人攻击）时，身份验证至关重要。

1985 年，首次有人提出了将椭圆曲线应用到密码学中。

椭圆曲线（Elliptic Curve），是由 `y^2 = x^3 + ax + b` 形式的方程定义的平面代数曲线，它在密码学中得到重要应用，即椭圆曲线密码学（ECC，见后文）。

椭圆曲线的相关名词： 

- Edwards Curves，爱德华曲线集，在此基础上衍生了 **Twisted Edwards Curves**。
- **Curve25519**，为 ECDH 协议设计的一个曲线，于 2005 年发布，是目前已知最快的 ECC 曲线之一。该曲线在双有理上等效于 Ed25519 签名方案中使用的 Twisted Edwards Curve。使用该曲线的 DH 函数被称作 **X25519**。
- **P-256** 曲线，P 意为素数，该类曲线的代表有，比特币所使用的 secp256k1，和美国国安局所使用的 secp256r1。

需要注意的一点是，采用不同的椭圆曲线，与算法的安全性和破解难度没有太大关系，它们主要是生成公私钥的速度上的差别。

**ECC**（Elliptic Curve Cryptography），椭圆曲线密码学，指基于椭圆曲线数学的**非对称**式加密演算法。说人话，它 1）目的是加密和解密一段信息；2）基于密钥实现，且是一副公钥和一副私钥；3）采用了椭圆曲线，这使得它能创建出更难破解的公私钥对，具备了比 RSA 更好的安全性。

将 ECC 应用到 DH 之上，则衍生出了 DH 的变种——**ECDH**（Elliptic Curve Diffie–Hellman key exchange），这种密钥交换协议具备了更好的性能与安全性。

在大型量子计算机发明之前，也即十年甚至更长的时间内，ECDH 都将是安全的。但为了提前应对椭圆曲线的破解，已经有密码学家开始了后量子密码学（Post-quantum cryptography）的研究。

其它比较知名的 ECC 加密方案（cryptographic schemes）还有：

- **ECDSA**（Elliptic Curve Digital Signature Algorithm），采用椭圆曲线的非对称数字签名算法。
- **EdDSA** (Edwards-curve Digital Signature Algorithm)，采用 Twisted Edwards Curve 的数字签名算法，2011 年发布。具体的签名方案（signature schemes）包括：
    - **Ed25519**，采用 Curve25519 曲线，及 SHA-512 (SHA-2) 哈希函数，目前相对流行的方案。
    - Ed448，采用 Curve448 曲线，及 SHA-3 哈希函数。
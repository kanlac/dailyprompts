# Docker 的分层镜像是怎么回事？它解决了什么问题？

通过 chroot 系统调用，由多个 rootfs 层叠形成，形成一个文件系统的单一视图。

联合文件系统的优势：

1. 高效存储，多个镜像可以共享相同的基础层，从而减少重复数据的存储，节省磁盘空间
2. 一定程度上可以提高构建效率，只要不修改之前的层，就可以使用缓存
3. 快速启动，通过联合挂载可以迅速启动一个容器，不需要数据复制就能实现操作系统的「克隆」。容器运行时，Docker 会在最上层创建一个可写层，所有对文件系统的修改都会在这个层中进行，而不改变底层的只读层。注意它是复制了操作系统但没有复制内核，所有容器的内核是共享的

有这么一个简单的小实验：把 bash 命令和它的依赖都拷贝到一个 test 目录下，并使用 `chroot` 命令（在 Docker 中则可能是 `pivot_root` ）修改 `bash` 二进制的根目录：

```go
chroot test /bin/bash
```

现在执行 `ls /` ，会看到它返回的都是 test 目录下的内容，说明它的根文件系统（rootfs）已经被修改。

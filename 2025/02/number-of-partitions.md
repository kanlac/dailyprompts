# 如何确定分区数量

不能取模，再平衡成本很高，以下是三种常见的分区策略：

1. 固定分区数量。比如对于一个 10 节点的集群，可以一开始就固定 1000 个分区，当节点数量变化时，不需要调整哈希值与分区的映射关系，只需要让新节点从旧节点上匀走一些分区。ElasticSearch 原生支持。哈希环+固定数量的虚拟节点也属于这种分区策略。缺点：
    1. 对于采用关键字分区的情况，可能导致不均匀，调整起来也很不灵活
    2. 若总数据量高度不确定，难以确定最佳分区大小
2. 分区数随数据量变化。优势是分区数量可以自动适配数据总量变化，使用 B+ 树分裂或合并分区，数据少则分区少、系统开销小。既适用于基于关键词的分区，也适用于基于关键字哈希的分区。MongoDB 原生支持。缺点：
    1. 一开始数据量很少时，其它节点会闲置，可通过预分裂解决
3. 分区数随节点数量变化。按节点比例分区，每个节点拥有固定数量的分区，Cassandra 原生支持，特点是保持每个分区大小稳定